<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¦™è‚ å¤§ä¹±æ–—ï¼šæš´å‡»é£˜å­—ç‰ˆ</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #ffeb3b; overflow: hidden; position: relative; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: none; }
        
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: flex; justify-content: center; align-items: center;
            z-index: 999; color: white; flex-direction: column; cursor: pointer; text-align: center;
        }
        
        #play-btn {
            background: #ff5722; color: white; padding: 15px 40px; border-radius: 50px;
            margin-top: 30px; font-size: 24px; font-weight: bold;
            box-shadow: 0 0 20px rgba(255, 87, 34, 0.6);
            animation: pulse 1s infinite;
        }

        /* èƒŒæ™¯æ€»åˆ†æ¿ */
        #scoreboard {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 100px; font-family: 'Arial Black', sans-serif; font-weight: 900;
            color: rgba(0, 0, 0, 0.05); /* é¢œè‰²æ·¡ä¸€ç‚¹ï¼Œä¸è¦æŠ¢æˆ */
            z-index: 1; pointer-events: none; transition: transform 0.1s;
        }

        /* --- æ–°å¢ï¼šæ’å‡»ç‚¹é£˜å­—ç‰¹æ•ˆ --- */
        .score-float {
            position: absolute;
            font-size: 28px;
            font-weight: 900;
            color: #d32f2f;
            text-shadow: 2px 2px 0px #fff; /* ç™½è‰²æè¾¹è®©å­—æ›´æ¸…æ¥š */
            z-index: 30; /* åœ¨æœ€ä¸Šå±‚ */
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
        }

        @keyframes floatUp {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -100px) scale(1); opacity: 0; }
        }

        .sausage-box { position: absolute; display: flex; justify-content: center; align-items: center; visibility: hidden; will-change: transform; cursor: grab; }
        .sausage-box:active { cursor: grabbing; }
        .sausage-box svg { animation-play-state: paused; }
        body.playing .sausage-box svg { animation-play-state: running; }
        
        .particle {
            position: absolute; width: 8px; height: 8px; background-color: #cd5c5c;
            border-radius: 50%; pointer-events: none; z-index: 20;
        }

        .shake-screen { animation: screen-shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        
        @keyframes screen-shake {
            0% { transform: translate(0, 0) rotate(0deg); }
            15% { transform: translate(-25px, 15px) rotate(-5deg); }
            30% { transform: translate(20px, -20px) rotate(3deg); }
            45% { transform: translate(-15px, 10px) rotate(-3deg); }
            60% { transform: translate(10px, -15px) rotate(2deg); }
            75% { transform: translate(-5px, 5px) rotate(-1deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        #big-sausage { width: 320px; height: 320px; z-index: 10; }
        #big-sausage svg { width: 100%; height: 100%; animation: spin 0.8s linear infinite; filter: drop-shadow(15px 15px 25px rgba(0,0,0,0.4)); }
        #small-sausage { width: 160px; height: 160px; z-index: 5; }
        #small-sausage svg { width: 100%; height: 100%; animation: spin 0.5s linear infinite; filter: drop-shadow(8px 8px 15px rgba(0,0,0,0.3)); }
        svg rect { rx: 60; ry: 60; }
        
        .text { position: absolute; bottom: 20px; width: 100%; text-align: center; color: #d32f2f; font-size: 14px; opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body id="game-body">

    <audio id="bgm" loop preload="auto" playsinline webkit-playsinline>
        <source src="bgm.mp3" type="audio/mpeg">
    </audio>

    <div id="start-overlay">
        <div style="font-size: 60px">ğŸ¥Š</div>
        <div style="font-size: 20px; margin-top: 10px">
            ç”¨åŠ›ç”©åŠ¨ Â· æ‹’ç»è½»è¹­
        </div>
        <div id="play-btn">å¼€å§‹æš´å‡»</div>
    </div>

    <div id="scoreboard">0</div>
    <div id="particles-container"></div>

    <div id="big-sausage" class="sausage-box">
        <svg viewBox="-140 -140 280 280" xmlns="http://www.w3.org/2000/svg"><rect x="-55" y="-130" width="110" height="260" fill="#cd5c5c" /><path d="M -35 -90 Q -25 0 -35 90" stroke="rgba(255,255,255,0.5)" stroke-width="14" fill="none" stroke-linecap="round" /><path d="M -25 -110 Q 0 -120 25 -110" stroke="rgba(255,255,255,0.4)" stroke-width="10" fill="none" stroke-linecap="round" /><path d="M -45 -50 L 5 -60" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -40 30 L 15 20" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -45 110 L 0 100" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /></svg>
    </div>
    <div id="small-sausage" class="sausage-box">
        <svg viewBox="-140 -140 280 280" xmlns="http://www.w3.org/2000/svg"><rect x="-55" y="-130" width="110" height="260" fill="#cd5c5c" /><path d="M -35 -90 Q -25 0 -35 90" stroke="rgba(255,255,255,0.5)" stroke-width="14" fill="none" stroke-linecap="round" /><path d="M -25 -110 Q 0 -120 25 -110" stroke="rgba(255,255,255,0.4)" stroke-width="10" fill="none" stroke-linecap="round" /><path d="M -45 -50 L 5 -60" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -40 30 L 15 20" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -45 110 L 0 100" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /></svg>
    </div>

    <div class="text">âš ï¸ ç”¨åŠ›ç ¸å‘å¢™å£æ‰æœ‰åˆ†ï¼ âš ï¸</div>

    <script>
        const w = window.innerWidth, h = window.innerHeight;
        let score = 0;
        
        const items = [
            { id: 'big', el: document.getElementById('big-sausage'), x: w/2-160, y: h/2-160, vx: 0, vy: 0, w: 320, h: 320, cooldown: 0, isDragging: false },
            { id: 'small', el: document.getElementById('small-sausage'), x: w/2-80, y: h/2-80, vx: 0, vy: 0, w: 160, h: 160, cooldown: 0, isDragging: false }
        ];
        items.forEach(i => { i.el.style.transform = `translate(${i.x}px, ${i.y}px)`; i.el.style.visibility = 'visible'; });

        let isPlaying = false;
        let gravityX = 0, gravityY = 0;
        const body = document.getElementById('game-body');
        const particlesContainer = document.getElementById('particles-container');
        const scoreboard = document.getElementById('scoreboard');

        // === æ–°å¢ï¼šåœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºé£˜å­— ===
        function showFloatingScore(x, y, points) {
            // åˆ›å»ºæ•°å­—å…ƒç´ 
            const el = document.createElement('div');
            el.classList.add('score-float');
            el.innerText = "+" + points;
            
            // ç¡®ä¿æ–‡å­—ä¸ä¼šå®Œå…¨è´´åœ¨å±å¹•è¾¹ç¼˜å¤–é¢
            const safeX = Math.min(Math.max(x, 20), window.innerWidth - 20);
            const safeY = Math.min(Math.max(y, 40), window.innerHeight - 20);
            
            el.style.left = safeX + 'px';
            el.style.top = safeY + 'px';
            
            document.body.appendChild(el);

            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                el.remove();
            }, 800);

            // æ›´æ–°æ€»åˆ†
            score += points;
            scoreboard.innerText = score;
        }

        // ç¢è£‚ç‰¹æ•ˆ
        function createExplosion(x, y) {
            if (navigator.vibrate) navigator.vibrate([50, 50, 150]);
            
            // åªæœ‰å‰§çƒˆæ’å‡»æ‰æ™ƒåŠ¨å±å¹•
            body.classList.remove('shake-screen');
            void body.offsetWidth; 
            body.classList.add('shake-screen');

            for (let i = 0; i < 15; i++) {
                const p = document.createElement('div');
                p.classList.add('particle');
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                p.style.width = (Math.random() * 12 + 4) + 'px';
                p.style.height = p.style.width;
                p.style.background = Math.random() > 0.6 ? '#cd5c5c' : '#8b0000';
                particlesContainer.appendChild(p);

                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 12 + 4; 
                const velX = Math.cos(angle) * velocity;
                const velY = Math.sin(angle) * velocity;

                let opacity = 1;
                let posX = x, posY = y;

                const anim = setInterval(() => {
                    posX += velX; posY += velY;
                    posY += 1.5; // ç²’å­é‡åŠ›ç•¥å¾®åŠ å¤§
                    opacity -= 0.05;
                    p.style.left = posX + 'px';
                    p.style.top = posY + 'px';
                    p.style.opacity = opacity;
                    if (opacity <= 0) { clearInterval(anim); p.remove(); }
                }, 20);
            }
        }

        function animate() {
            if(isPlaying) {
                const cw = window.innerWidth, ch = window.innerHeight;
                items.forEach(i => {
                    if (i.cooldown > 0) i.cooldown--;

                    if (!i.isDragging) {
                        i.vx += gravityX * 0.6;
                        i.vy += gravityY * 0.6;
                        i.vx *= 0.98; i.vy *= 0.98;
                        i.x += i.vx; i.y += i.vy;

                        // è®¡ç®—åˆé€Ÿåº¦
                        const speed = Math.sqrt(i.vx*i.vx + i.vy*i.vy);
                        
                        let hit = false;
                        let hitX = 0, hitY = 0;

                        if (i.x <= 0) {
                            i.x = 0; i.vx *= -0.6; 
                            hit = true; hitX = 30; hitY = i.y + i.h/2; // æ’ç‚¹ä¿®æ­£åˆ°å±å¹•å†…ä¸€ç‚¹
                        }
                        if (i.x + i.w >= cw) {
                            i.x = cw - i.w; i.vx *= -0.6;
                            hit = true; hitX = cw - 30; hitY = i.y + i.h/2;
                        }
                        if (i.y <= 0) {
                            i.y = 0; i.vy *= -0.6;
                            hit = true; hitX = i.x + i.w/2; hitY = 30;
                        }
                        if (i.y + i.h >= ch) {
                            i.y = ch - i.h; i.vy *= -0.6;
                            hit = true; hitX = i.x + i.w/2; hitY = ch - 30;
                        }

                        // --- æ ¸å¿ƒä¿®æ”¹ï¼šæé«˜é˜ˆå€¼ ---
                        // åŸæ¥æ˜¯ 8ï¼Œç°åœ¨æ”¹ä¸º 15ã€‚
                        // è¿™æ„å‘³ç€è½»å¾®çš„æ»‘åŠ¨ï¼ˆé€Ÿåº¦é€šå¸¸åœ¨ 2-8 ä¹‹é—´ï¼‰ä¸ä¼šè§¦å‘ä»»ä½•æ•ˆæœ
                        if (hit && speed > 15 && i.cooldown <= 0) {
                            createExplosion(hitX, hitY);
                            
                            // åœ¨æ’å‡»ç‚¹æ˜¾ç¤ºåˆ†æ•°
                            if (i.id === 'big') showFloatingScore(hitX, hitY, 228);
                            else showFloatingScore(hitX, hitY, 114);
                            
                            i.cooldown = 25; // å†·å´æ—¶é—´ç¨å¾®å¢åŠ ï¼Œé˜²æ­¢è¿ç»­è¯¯åˆ¤
                        }
                    }

                    i.el.style.transform = `translate(${i.x}px, ${i.y}px)`;
                });
            }
            requestAnimationFrame(animate);
        }
        animate();

        // æ‹–æ‹½é€»è¾‘
        let dragItem = null;
        let dragOffsetX = 0, dragOffsetY = 0;
        let lastX = 0, lastY = 0;
        let dragVx = 0, dragVy = 0;

        function handleStart(e) {
            const target = e.target.closest('.sausage-box');
            if (!target) return;
            const item = items.find(i => i.el === target);
            if (!item) return;

            e.preventDefault();
            dragItem = item;
            dragItem.isDragging = true;
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            dragOffsetX = clientX - dragItem.x;
            dragOffsetY = clientY - dragItem.y;
            lastX = clientX; lastY = clientY;
            dragVx = 0; dragVy = 0;
        }

        function handleMove(e) {
            if (!dragItem) return;
            e.preventDefault();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            dragItem.x = clientX - dragOffsetX;
            dragItem.y = clientY - dragOffsetY;

            dragVx = clientX - lastX;
            dragVy = clientY - lastY;
            lastX = clientX; lastY = clientY;
        }

        function handleEnd(e) {
            if (!dragItem) return;
            // æŠ•æ·åŠ›åº¦å¢å¼º 1.8 å€ï¼Œæ›´å®¹æ˜“è§¦å‘æš´å‡»
            dragItem.vx = dragVx * 1.8;
            dragItem.vy = dragVy * 1.8;
            dragItem.isDragging = false;
            dragItem = null;
        }

        document.addEventListener('touchstart', handleStart, {passive: false});
        document.addEventListener('touchmove', handleMove, {passive: false});
        document.addEventListener('touchend', handleEnd);
        document.addEventListener('mousedown', handleStart);
        document.addEventListener('mousemove', handleMove);
        document.addEventListener('mouseup', handleEnd);

        const bgm = document.getElementById('bgm');
        const overlay = document.getElementById('start-overlay');
        const playBtn = document.getElementById('play-btn');

        function handleOrientation(event) {
            gravityX = (event.gamma || 0) / 4; 
            gravityY = (event.beta || 0) / 4;
        }

        async function startGame() {
            if(isPlaying) return;
            bgm.volume = 1.0; bgm.currentTime = 0;
            bgm.play().then(() => { bgm.playbackRate = 1.5; }).catch(console.log);

            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permissionState = await DeviceOrientationEvent.requestPermission();
                    if (permissionState === 'granted') {
                        window.addEventListener('deviceorientation', handleOrientation);
                    }
                } catch (e) { console.error(e); }
            } else {
                window.addEventListener('deviceorientation', handleOrientation);
            }

            overlay.style.display = 'none';
            document.body.classList.add('playing');
            isPlaying = true;
        }

        playBtn.addEventListener('click', startGame);
    </script>
</body>
</html>
