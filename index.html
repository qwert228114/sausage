<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä½“æ„Ÿé¦™è‚ å¤§ä¹±æ–—</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #ffeb3b; overflow: hidden; position: relative; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        /* å¯åŠ¨é®ç½© */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: flex; justify-content: center; align-items: center;
            z-index: 999; color: white; flex-direction: column; cursor: pointer; text-align: center;
        }
        
        #play-btn {
            background: #ff5722; color: white; padding: 15px 40px; border-radius: 50px;
            margin-top: 30px; font-size: 24px; font-weight: bold;
            box-shadow: 0 0 20px rgba(255, 87, 34, 0.6);
            animation: pulse 1s infinite;
        }

        /* é¦™è‚ å®¹å™¨ */
        .sausage-box { position: absolute; display: flex; justify-content: center; align-items: center; visibility: hidden; will-change: transform; }
        .sausage-box svg { animation-play-state: paused; }
        body.playing .sausage-box svg { animation-play-state: running; }
        
        /* ç¢è£‚ç²’å­æ ·å¼ */
        .particle {
            position: absolute;
            width: 8px; height: 8px;
            background-color: #cd5c5c; /* è‚‰è‰² */
            border-radius: 50%;
            pointer-events: none;
            z-index: 20;
        }

        /* å±å¹•æ’å‡»éœ‡åŠ¨åŠ¨ç”» */
        .shake-screen { animation: screen-shake 0.2s ease-in-out; }
        @keyframes screen-shake {
            0% { transform: translate(0, 0); }
            25% { transform: translate(-5px, 5px); }
            50% { transform: translate(5px, -5px); }
            75% { transform: translate(-5px, -5px); }
            100% { transform: translate(0, 0); }
        }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        #big-sausage { width: 320px; height: 320px; z-index: 10; }
        #big-sausage svg { width: 100%; height: 100%; animation: spin 0.8s linear infinite; filter: drop-shadow(15px 15px 25px rgba(0,0,0,0.4)); }
        #small-sausage { width: 160px; height: 160px; z-index: 5; }
        #small-sausage svg { width: 100%; height: 100%; animation: spin 0.5s linear infinite; filter: drop-shadow(8px 8px 15px rgba(0,0,0,0.3)); }
        svg rect { rx: 60; ry: 60; }
        
        .text { position: absolute; bottom: 20px; width: 100%; text-align: center; color: #d32f2f; font-size: 14px; opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body id="game-body">

    <audio id="bgm" loop preload="auto" playsinline webkit-playsinline>
        <source src="bgm.mp3" type="audio/mpeg">
    </audio>

    <div id="start-overlay">
        <div style="font-size: 60px">ğŸ“±</div>
        <div style="font-size: 20px; margin-top: 10px">
            æ™ƒåŠ¨æ‰‹æœº Â· æ’å‡»ç¢è£‚ Â· éœ‡åŠ¨åé¦ˆ
        </div>
        <div id="play-btn">å¼€å¯ä½“æ„Ÿæ¨¡å¼</div>
        <div id="status" style="margin-top:15px; font-size:12px; color:#888;"></div>
    </div>

    <div id="particles-container"></div>

    <div id="big-sausage" class="sausage-box">
        <svg viewBox="-140 -140 280 280" xmlns="http://www.w3.org/2000/svg"><rect x="-55" y="-130" width="110" height="260" fill="#cd5c5c" /><path d="M -35 -90 Q -25 0 -35 90" stroke="rgba(255,255,255,0.5)" stroke-width="14" fill="none" stroke-linecap="round" /><path d="M -25 -110 Q 0 -120 25 -110" stroke="rgba(255,255,255,0.4)" stroke-width="10" fill="none" stroke-linecap="round" /><path d="M -45 -50 L 5 -60" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -40 30 L 15 20" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -45 110 L 0 100" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /></svg>
    </div>
    <div id="small-sausage" class="sausage-box">
        <svg viewBox="-140 -140 280 280" xmlns="http://www.w3.org/2000/svg"><rect x="-55" y="-130" width="110" height="260" fill="#cd5c5c" /><path d="M -35 -90 Q -25 0 -35 90" stroke="rgba(255,255,255,0.5)" stroke-width="14" fill="none" stroke-linecap="round" /><path d="M -25 -110 Q 0 -120 25 -110" stroke="rgba(255,255,255,0.4)" stroke-width="10" fill="none" stroke-linecap="round" /><path d="M -45 -50 L 5 -60" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -40 30 L 15 20" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -45 110 L 0 100" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /></svg>
    </div>

    <div class="text">âš ï¸ å€¾æ–œæ‰‹æœºæ§åˆ¶é‡åŠ› âš ï¸</div>

    <script>
        // === 1. åˆå§‹åŒ–å˜é‡ ===
        const w = window.innerWidth, h = window.innerHeight;
        // åˆå§‹é€Ÿåº¦è®¾ä¸º0ï¼Œå®Œå…¨ç”±é‡åŠ›æ§åˆ¶ï¼Œæˆ–è€…ä¿ç•™ä¸€ç‚¹åˆé€Ÿåº¦
        const items = [
            { el: document.getElementById('big-sausage'), x: w/2-160, y: h/2-160, vx: 0, vy: 0, w: 320, h: 320, mass: 2 },
            { el: document.getElementById('small-sausage'), x: w/2-80, y: h/2-80, vx: 0, vy: 0, w: 160, h: 160, mass: 1 }
        ];
        items.forEach(i => { i.el.style.transform = `translate(${i.x}px, ${i.y}px)`; i.el.style.visibility = 'visible'; });

        let isPlaying = false;
        let gravityX = 0;
        let gravityY = 0;
        const body = document.getElementById('game-body');
        const particlesContainer = document.getElementById('particles-container');

        // === 2. ç¢è£‚ç‰¹æ•ˆ (ç²’å­ç³»ç»Ÿ) ===
        function createExplosion(x, y, amount) {
            // æ‰‹æœºéœ‡åŠ¨ (200æ¯«ç§’)
            if (navigator.vibrate) navigator.vibrate(200);

            // å±å¹•æ™ƒåŠ¨ç‰¹æ•ˆ
            body.classList.remove('shake-screen');
            void body.offsetWidth; // è§¦å‘é‡ç»˜
            body.classList.add('shake-screen');

            // äº§ç”Ÿç²’å­
            for (let i = 0; i < amount; i++) {
                const p = document.createElement('div');
                p.classList.add('particle');
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                
                // éšæœºå¤§å°å’Œé¢œè‰²æ·±æµ…
                const size = Math.random() * 10 + 5;
                p.style.width = size + 'px';
                p.style.height = size + 'px';
                p.style.background = Math.random() > 0.5 ? '#cd5c5c' : '#8b0000'; // ä¸¤ç§è‚‰è‰²

                particlesContainer.appendChild(p);

                // éšæœºçˆ†ç‚¸æ–¹å‘
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 10 + 2;
                const velX = Math.cos(angle) * velocity;
                const velY = Math.sin(angle) * velocity;

                // ç®€å•çš„ç²’å­åŠ¨ç”»
                let opacity = 1;
                let posX = x;
                let posY = y;

                const anim = setInterval(() => {
                    posX += velX;
                    posY += velY;
                    opacity -= 0.05;
                    p.style.left = posX + 'px';
                    p.style.top = posY + 'px';
                    p.style.opacity = opacity;

                    if (opacity <= 0) {
                        clearInterval(anim);
                        p.remove();
                    }
                }, 20);
            }
        }

        // === 3. ç‰©ç†å¼•æ“å¾ªç¯ ===
        function animate() {
            if(isPlaying) {
                const cw = window.innerWidth, ch = window.innerHeight;

                items.forEach(i => {
                    // åŠ ä¸Šé‡åŠ›æ„Ÿåº”å¸¦æ¥çš„åŠ é€Ÿåº¦ (è°ƒæ•´ç³»æ•° 0.5 è®©æ§åˆ¶æ›´è·Ÿæ‰‹)
                    i.vx += gravityX * 0.5;
                    i.vy += gravityY * 0.5;

                    // æ‘©æ“¦åŠ› (é˜²æ­¢æ— é™åŠ é€Ÿ)
                    i.vx *= 0.98;
                    i.vy *= 0.98;

                    // æ›´æ–°ä½ç½®
                    i.x += i.vx;
                    i.y += i.vy;

                    // --- ç¢°æ’æ£€æµ‹æ ¸å¿ƒ ---
                    let hit = false;
                    let hitX = 0, hitY = 0;

                    // æ’å·¦å¢™
                    if (i.x <= 0) {
                        i.x = 0; 
                        i.vx = -i.vx * 0.6; // åå¼¹å¹¶è¡°å‡
                        hit = true; hitX = 0; hitY = i.y + i.h/2;
                    }
                    // æ’å³å¢™
                    if (i.x + i.w >= cw) {
                        i.x = cw - i.w;
                        i.vx = -i.vx * 0.6;
                        hit = true; hitX = cw; hitY = i.y + i.h/2;
                    }
                    // æ’é¡¶
                    if (i.y <= 0) {
                        i.y = 0;
                        i.vy = -i.vy * 0.6;
                        hit = true; hitX = i.x + i.w/2; hitY = 0;
                    }
                    // æ’åº•
                    if (i.y + i.h >= ch) {
                        i.y = ch - i.h;
                        i.vy = -i.vy * 0.6;
                        hit = true; hitX = i.x + i.w/2; hitY = ch;
                    }

                    // åªæœ‰å½“æ’å‡»é€Ÿåº¦è¶³å¤Ÿå¿«æ—¶ï¼Œæ‰è§¦å‘ç‰¹æ•ˆï¼ˆé˜²æ­¢é™æ­¢æ—¶ä¸€ç›´éœ‡åŠ¨ï¼‰
                    if (hit && (Math.abs(i.vx) > 2 || Math.abs(i.vy) > 2)) {
                        // ç‚¸å‡º 10-15 ä¸ªç²’å­
                        createExplosion(hitX, hitY, 15);
                    }

                    i.el.style.transform = `translate(${i.x}px, ${i.y}px)`;
                });
            }
            requestAnimationFrame(animate);
        }
        animate();

        // === 4. é™€èºä»ªä¸å¯åŠ¨é€»è¾‘ ===
        const bgm = document.getElementById('bgm');
        const overlay = document.getElementById('start-overlay');
        const status = document.getElementById('status');
        const playBtn = document.getElementById('play-btn');

        function handleOrientation(event) {
            // gamma: å·¦å€¾(-90) åˆ° å³å€¾(90)
            // beta:  å‰å€¾(-180) åˆ° åå€¾(180)
            // é™åˆ¶ä¸€ä¸‹æœ€å¤§å€¼ï¼Œé˜²æ­¢åŠ é€Ÿåº¦è¿‡å¤§
            const x = event.gamma || 0; 
            const y = event.beta || 0;
            
            // ç®€å•çš„æ˜ å°„
            gravityX = x / 5; 
            gravityY = y / 5;
        }

        async function startGame() {
            if(isPlaying) return;

            status.textContent = "æ­£åœ¨è¯·æ±‚ä¼ æ„Ÿå™¨æƒé™...";
            
            // 1. å¤„ç†éŸ³é¢‘
            bgm.volume = 1.0;
            bgm.currentTime = 0;
            bgm.play().then(() => { bgm.playbackRate = 1.5; }).catch(e => console.log(e));

            // 2. å¤„ç† iOS 13+ çš„é™€èºä»ªæƒé™ (è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥)
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permissionState = await DeviceOrientationEvent.requestPermission();
                    if (permissionState === 'granted') {
                        window.addEventListener('deviceorientation', handleOrientation);
                        status.textContent = "ä¼ æ„Ÿå™¨å·²è¿æ¥ï¼";
                    } else {
                        status.textContent = "âŒ æƒé™è¢«æ‹’ç»ï¼Œæ— æ³•ä½¿ç”¨ä½“æ„Ÿ";
                        alert("è¯·å…è®¸åŠ¨ä½œä¸æ–¹å‘æƒé™ï¼Œå¦åˆ™æ— æ³•æ™ƒåŠ¨é¦™è‚ ");
                    }
                } catch (error) {
                    console.error(error);
                }
            } else {
                // é iOS 13+ è®¾å¤‡ (Android æˆ–æ—§ iOS) ç›´æ¥ç›‘å¬
                window.addEventListener('deviceorientation', handleOrientation);
            }

            // 3. å¯åŠ¨ç”»é¢
            overlay.style.display = 'none';
            document.body.classList.add('playing');
            isPlaying = true;
        }

        playBtn.addEventListener('click', startGame);

    </script>
</body>
</html>
