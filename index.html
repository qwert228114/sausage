<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¦™è‚ å¤§ä¹±æ–—ï¼šæ‹–æ‹½æŠ•æ·ç‰ˆ</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #ffeb3b; overflow: hidden; position: relative; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: none; /* ç¦æ­¢æµè§ˆå™¨é»˜è®¤æ»šåŠ¨ */ }
        
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: flex; justify-content: center; align-items: center;
            z-index: 999; color: white; flex-direction: column; cursor: pointer; text-align: center;
        }
        
        #play-btn {
            background: #ff5722; color: white; padding: 15px 40px; border-radius: 50px;
            margin-top: 30px; font-size: 24px; font-weight: bold;
            box-shadow: 0 0 20px rgba(255, 87, 34, 0.6);
            animation: pulse 1s infinite;
        }

        /* è®¡åˆ†æ¿æ ·å¼ */
        #scoreboard {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            font-family: 'Arial Black', sans-serif;
            font-weight: 900;
            color: rgba(0, 0, 0, 0.1); /* åŠé€æ˜é»‘è‰² */
            z-index: 1; /* åœ¨æœ€åº•å±‚ */
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€å®ƒ */
            transition: transform 0.1s;
        }
        /* å¾—åˆ†æ—¶çš„åŠ¨ç”» */
        .score-pop { transform: translate(-50%, -50%) scale(1.2) !important; color: rgba(211, 47, 47, 0.2) !important; }

        .sausage-box { position: absolute; display: flex; justify-content: center; align-items: center; visibility: hidden; will-change: transform; cursor: grab; }
        .sausage-box:active { cursor: grabbing; }
        .sausage-box svg { animation-play-state: paused; }
        body.playing .sausage-box svg { animation-play-state: running; }
        
        .particle {
            position: absolute; width: 8px; height: 8px; background-color: #cd5c5c;
            border-radius: 50%; pointer-events: none; z-index: 20;
        }

        .shake-screen { animation: screen-shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        
        @keyframes screen-shake {
            0% { transform: translate(0, 0) rotate(0deg); }
            15% { transform: translate(-25px, 15px) rotate(-5deg); }
            30% { transform: translate(20px, -20px) rotate(3deg); }
            45% { transform: translate(-15px, 10px) rotate(-3deg); }
            60% { transform: translate(10px, -15px) rotate(2deg); }
            75% { transform: translate(-5px, 5px) rotate(-1deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        #big-sausage { width: 320px; height: 320px; z-index: 10; }
        #big-sausage svg { width: 100%; height: 100%; animation: spin 0.8s linear infinite; filter: drop-shadow(15px 15px 25px rgba(0,0,0,0.4)); }
        #small-sausage { width: 160px; height: 160px; z-index: 5; }
        #small-sausage svg { width: 100%; height: 100%; animation: spin 0.5s linear infinite; filter: drop-shadow(8px 8px 15px rgba(0,0,0,0.3)); }
        svg rect { rx: 60; ry: 60; }
        
        .text { position: absolute; bottom: 20px; width: 100%; text-align: center; color: #d32f2f; font-size: 14px; opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body id="game-body">

    <audio id="bgm" loop preload="auto" playsinline webkit-playsinline>
        <source src="bgm.mp3" type="audio/mpeg">
    </audio>

    <div id="start-overlay">
        <div style="font-size: 60px">ğŸ–ï¸</div>
        <div style="font-size: 20px; margin-top: 10px">
            æ‹–æ‹½æŠ•æ· Â· æ™ƒåŠ¨æ’å‡» Â· ç´¯ç§¯åˆ†æ•°
        </div>
        <div id="play-btn">å¼€å§‹æŒ‘æˆ˜</div>
    </div>

    <div id="scoreboard">0</div>

    <div id="particles-container"></div>

    <div id="big-sausage" class="sausage-box">
        <svg viewBox="-140 -140 280 280" xmlns="http://www.w3.org/2000/svg"><rect x="-55" y="-130" width="110" height="260" fill="#cd5c5c" /><path d="M -35 -90 Q -25 0 -35 90" stroke="rgba(255,255,255,0.5)" stroke-width="14" fill="none" stroke-linecap="round" /><path d="M -25 -110 Q 0 -120 25 -110" stroke="rgba(255,255,255,0.4)" stroke-width="10" fill="none" stroke-linecap="round" /><path d="M -45 -50 L 5 -60" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -40 30 L 15 20" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -45 110 L 0 100" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /></svg>
    </div>
    <div id="small-sausage" class="sausage-box">
        <svg viewBox="-140 -140 280 280" xmlns="http://www.w3.org/2000/svg"><rect x="-55" y="-130" width="110" height="260" fill="#cd5c5c" /><path d="M -35 -90 Q -25 0 -35 90" stroke="rgba(255,255,255,0.5)" stroke-width="14" fill="none" stroke-linecap="round" /><path d="M -25 -110 Q 0 -120 25 -110" stroke="rgba(255,255,255,0.4)" stroke-width="10" fill="none" stroke-linecap="round" /><path d="M -45 -50 L 5 -60" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -40 30 L 15 20" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -45 110 L 0 100" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /></svg>
    </div>

    <div class="text">âš ï¸ ç”¨åŠ›æŠŠé¦™è‚ ç”©åˆ°å¢™ä¸Šï¼ âš ï¸</div>

    <script>
        const w = window.innerWidth, h = window.innerHeight;
        let score = 0;
        
        // å¢åŠ  isDragging çŠ¶æ€ï¼Œé˜²æ­¢æ‹–æ‹½æ—¶ç‰©ç†å¼•æ“å¹²æ‰°
        const items = [
            { id: 'big', el: document.getElementById('big-sausage'), x: w/2-160, y: h/2-160, vx: 0, vy: 0, w: 320, h: 320, cooldown: 0, isDragging: false },
            { id: 'small', el: document.getElementById('small-sausage'), x: w/2-80, y: h/2-80, vx: 0, vy: 0, w: 160, h: 160, cooldown: 0, isDragging: false }
        ];
        items.forEach(i => { i.el.style.transform = `translate(${i.x}px, ${i.y}px)`; i.el.style.visibility = 'visible'; });

        let isPlaying = false;
        let gravityX = 0, gravityY = 0;
        const body = document.getElementById('game-body');
        const particlesContainer = document.getElementById('particles-container');
        const scoreboard = document.getElementById('scoreboard');

        // æ›´æ–°è®¡åˆ†
        function addScore(points) {
            score += points;
            scoreboard.innerText = score;
            // å¾—åˆ†åŠ¨ç”»
            scoreboard.classList.remove('score-pop');
            void scoreboard.offsetWidth;
            scoreboard.classList.add('score-pop');
        }

        // ç¢è£‚ç‰¹æ•ˆ
        function createExplosion(x, y) {
            if (navigator.vibrate) navigator.vibrate([50, 50, 150]);
            body.classList.remove('shake-screen');
            void body.offsetWidth; 
            body.classList.add('shake-screen');

            for (let i = 0; i < 20; i++) {
                const p = document.createElement('div');
                p.classList.add('particle');
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                p.style.width = (Math.random() * 15 + 5) + 'px';
                p.style.height = p.style.width;
                p.style.background = Math.random() > 0.6 ? '#cd5c5c' : '#8b0000';
                particlesContainer.appendChild(p);

                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 15 + 5; 
                const velX = Math.cos(angle) * velocity;
                const velY = Math.sin(angle) * velocity;

                let opacity = 1;
                let posX = x, posY = y;

                const anim = setInterval(() => {
                    posX += velX; posY += velY;
                    posY += 1; 
                    opacity -= 0.04;
                    p.style.left = posX + 'px';
                    p.style.top = posY + 'px';
                    p.style.opacity = opacity;
                    if (opacity <= 0) { clearInterval(anim); p.remove(); }
                }, 20);
            }
        }

        function animate() {
            if(isPlaying) {
                const cw = window.innerWidth, ch = window.innerHeight;
                items.forEach(i => {
                    if (i.cooldown > 0) i.cooldown--;

                    // åªæœ‰åœ¨æ²¡æœ‰è¢«æ‹–æ‹½çš„æ—¶å€™ï¼Œç‰©ç†å¼•æ“æ‰ç”Ÿæ•ˆ
                    if (!i.isDragging) {
                        i.vx += gravityX * 0.6;
                        i.vy += gravityY * 0.6;
                        i.vx *= 0.98; i.vy *= 0.98;
                        i.x += i.vx; i.y += i.vy;

                        const speed = Math.sqrt(i.vx*i.vx + i.vy*i.vy);
                        let hit = false;
                        let hitX = 0, hitY = 0;

                        if (i.x <= 0) {
                            i.x = 0; i.vx *= -0.6; 
                            hit = true; hitX = 0; hitY = i.y + i.h/2;
                        }
                        if (i.x + i.w >= cw) {
                            i.x = cw - i.w; i.vx *= -0.6;
                            hit = true; hitX = cw; hitY = i.y + i.h/2;
                        }
                        if (i.y <= 0) {
                            i.y = 0; i.vy *= -0.6;
                            hit = true; hitX = i.x + i.w/2; hitY = 0;
                        }
                        if (i.y + i.h >= ch) {
                            i.y = ch - i.h; i.vy *= -0.6;
                            hit = true; hitX = i.x + i.w/2; hitY = ch;
                        }

                        // æ’å‡»é€»è¾‘ï¼šé€Ÿåº¦ > 8 ä¸”å†·å´å®Œæ¯•
                        if (hit && speed > 8 && i.cooldown <= 0) {
                            createExplosion(hitX, hitY);
                            // è®¡åˆ†é€»è¾‘
                            if (i.id === 'big') addScore(228);
                            else addScore(114);
                            
                            i.cooldown = 20; 
                        }
                    }

                    i.el.style.transform = `translate(${i.x}px, ${i.y}px)`;
                });
            }
            requestAnimationFrame(animate);
        }
        animate();

        // === æ‹–æ‹½ä¸æŠ•æ·é€»è¾‘ ===
        let dragItem = null;
        let dragOffsetX = 0, dragOffsetY = 0;
        let lastX = 0, lastY = 0; // ç”¨äºè®¡ç®—æŠ•æ·é€Ÿåº¦
        let dragVx = 0, dragVy = 0;

        function handleStart(e) {
            // æ‰¾åˆ°ç‚¹å‡»çš„æ˜¯å“ªä¸ªé¦™è‚ 
            const target = e.target.closest('.sausage-box');
            if (!target) return;
            
            const item = items.find(i => i.el === target);
            if (!item) return;

            e.preventDefault(); // é˜²æ­¢æ»šåŠ¨
            dragItem = item;
            dragItem.isDragging = true; // æš‚åœç‰©ç†å¼•æ“

            // è·å–è§¦æ‘¸/é¼ æ ‡åæ ‡
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            // è®¡ç®—æ‰‹æŒ‡ç‚¹åœ¨é¦™è‚ çš„å“ªä¸ªä½ç½®
            dragOffsetX = clientX - dragItem.x;
            dragOffsetY = clientY - dragItem.y;
            
            // åˆå§‹åŒ–é€Ÿåº¦è®°å½•
            lastX = clientX;
            lastY = clientY;
            dragVx = 0; dragVy = 0;
        }

        function handleMove(e) {
            if (!dragItem) return;
            e.preventDefault();

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            // æ›´æ–°ä½ç½®
            dragItem.x = clientX - dragOffsetX;
            dragItem.y = clientY - dragOffsetY;

            // è®¡ç®—å³æ—¶é€Ÿåº¦ (ç”¨äºæŠ•æ·)
            dragVx = clientX - lastX;
            dragVy = clientY - lastY;
            
            lastX = clientX;
            lastY = clientY;
        }

        function handleEnd(e) {
            if (!dragItem) return;
            
            // é‡Šæ”¾æ—¶ï¼Œèµ‹äºˆé¦™è‚ æœ€åçš„æ‰‹åŠ¿é€Ÿåº¦ï¼ˆæŠ•æ·æ•ˆæœï¼‰
            // ä¹˜ä»¥ 1.5 è®©æŠ•æ·æ›´æœ‰åŠ›
            dragItem.vx = dragVx * 1.5;
            dragItem.vy = dragVy * 1.5;

            dragItem.isDragging = false; // æ¢å¤ç‰©ç†å¼•æ“
            dragItem = null;
        }

        // ç»‘å®šæ‹–æ‹½äº‹ä»¶
        document.addEventListener('touchstart', handleStart, {passive: false});
        document.addEventListener('touchmove', handleMove, {passive: false});
        document.addEventListener('touchend', handleEnd);
        document.addEventListener('mousedown', handleStart);
        document.addEventListener('mousemove', handleMove);
        document.addEventListener('mouseup', handleEnd);


        // === é™€èºä»ªä¸å¯åŠ¨é€»è¾‘ ===
        const bgm = document.getElementById('bgm');
        const overlay = document.getElementById('start-overlay');
        const playBtn = document.getElementById('play-btn');

        function handleOrientation(event) {
            gravityX = (event.gamma || 0) / 4; 
            gravityY = (event.beta || 0) / 4;
        }

        async function startGame() {
            if(isPlaying) return;
            bgm.volume = 1.0; bgm.currentTime = 0;
            bgm.play().then(() => { bgm.playbackRate = 1.5; }).catch(console.log);

            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permissionState = await DeviceOrientationEvent.requestPermission();
                    if (permissionState === 'granted') {
                        window.addEventListener('deviceorientation', handleOrientation);
                    }
                } catch (e) { console.error(e); }
            } else {
                window.addEventListener('deviceorientation', handleOrientation);
            }

            overlay.style.display = 'none';
            document.body.classList.add('playing');
            isPlaying = true;
        }

        playBtn.addEventListener('click', startGame);
    </script>
</body>
</html>
