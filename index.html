<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä½“æ„Ÿé¦™è‚ ï¼šæš´èºæ’å‡»ç‰ˆ</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #ffeb3b; overflow: hidden; position: relative; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: flex; justify-content: center; align-items: center;
            z-index: 999; color: white; flex-direction: column; cursor: pointer; text-align: center;
        }
        
        #play-btn {
            background: #ff5722; color: white; padding: 15px 40px; border-radius: 50px;
            margin-top: 30px; font-size: 24px; font-weight: bold;
            box-shadow: 0 0 20px rgba(255, 87, 34, 0.6);
            animation: pulse 1s infinite;
        }

        .sausage-box { position: absolute; display: flex; justify-content: center; align-items: center; visibility: hidden; will-change: transform; }
        .sausage-box svg { animation-play-state: paused; }
        body.playing .sausage-box svg { animation-play-state: running; }
        
        .particle {
            position: absolute; width: 8px; height: 8px; background-color: #cd5c5c;
            border-radius: 50%; pointer-events: none; z-index: 20;
        }

        /* --- å‡çº§ç‰ˆï¼šè¶…çº§å‰§çƒˆçš„å±å¹•æŠ–åŠ¨ --- */
        .shake-screen { animation: screen-shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        
        @keyframes screen-shake {
            0% { transform: translate(0, 0) rotate(0deg); }
            15% { transform: translate(-25px, 15px) rotate(-5deg); } /* å¹…åº¦åŠ å¤§ */
            30% { transform: translate(20px, -20px) rotate(3deg); }
            45% { transform: translate(-15px, 10px) rotate(-3deg); }
            60% { transform: translate(10px, -15px) rotate(2deg); }
            75% { transform: translate(-5px, 5px) rotate(-1deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        #big-sausage { width: 320px; height: 320px; z-index: 10; }
        #big-sausage svg { width: 100%; height: 100%; animation: spin 0.8s linear infinite; filter: drop-shadow(15px 15px 25px rgba(0,0,0,0.4)); }
        #small-sausage { width: 160px; height: 160px; z-index: 5; }
        #small-sausage svg { width: 100%; height: 100%; animation: spin 0.5s linear infinite; filter: drop-shadow(8px 8px 15px rgba(0,0,0,0.3)); }
        svg rect { rx: 60; ry: 60; }
        
        .text { position: absolute; bottom: 20px; width: 100%; text-align: center; color: #d32f2f; font-size: 14px; opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body id="game-body">

    <audio id="bgm" loop preload="auto" playsinline webkit-playsinline>
        <source src="bgm.mp3" type="audio/mpeg">
    </audio>

    <div id="start-overlay">
        <div style="font-size: 60px">ğŸ’¥</div>
        <div style="font-size: 20px; margin-top: 10px">
            ç”¨åŠ›æ™ƒåŠ¨ Â· æš´èºæ’å‡»
        </div>
        <div id="play-btn">å¼€å§‹</div>
        <div id="status" style="margin-top:15px; font-size:12px; color:#888;"></div>
    </div>

    <div id="particles-container"></div>

    <div id="big-sausage" class="sausage-box">
        <svg viewBox="-140 -140 280 280" xmlns="http://www.w3.org/2000/svg"><rect x="-55" y="-130" width="110" height="260" fill="#cd5c5c" /><path d="M -35 -90 Q -25 0 -35 90" stroke="rgba(255,255,255,0.5)" stroke-width="14" fill="none" stroke-linecap="round" /><path d="M -25 -110 Q 0 -120 25 -110" stroke="rgba(255,255,255,0.4)" stroke-width="10" fill="none" stroke-linecap="round" /><path d="M -45 -50 L 5 -60" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -40 30 L 15 20" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -45 110 L 0 100" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /></svg>
    </div>
    <div id="small-sausage" class="sausage-box">
        <svg viewBox="-140 -140 280 280" xmlns="http://www.w3.org/2000/svg"><rect x="-55" y="-130" width="110" height="260" fill="#cd5c5c" /><path d="M -35 -90 Q -25 0 -35 90" stroke="rgba(255,255,255,0.5)" stroke-width="14" fill="none" stroke-linecap="round" /><path d="M -25 -110 Q 0 -120 25 -110" stroke="rgba(255,255,255,0.4)" stroke-width="10" fill="none" stroke-linecap="round" /><path d="M -45 -50 L 5 -60" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -40 30 L 15 20" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /><path d="M -45 110 L 0 100" stroke="#8b0000" stroke-width="6" stroke-linecap="round" /></svg>
    </div>

    <div class="text">âš ï¸ ç”©èµ·æ¥æ‰æœ‰ç¢è£‚æ•ˆæœ âš ï¸</div>

    <script>
        const w = window.innerWidth, h = window.innerHeight;
        // cooldown: æ’å‡»å†·å´è®¡æ—¶å™¨ï¼Œé˜²æ­¢è¿ç»­éœ‡åŠ¨
        const items = [
            { el: document.getElementById('big-sausage'), x: w/2-160, y: h/2-160, vx: 0, vy: 0, w: 320, h: 320, cooldown: 0 },
            { el: document.getElementById('small-sausage'), x: w/2-80, y: h/2-80, vx: 0, vy: 0, w: 160, h: 160, cooldown: 0 }
        ];
        items.forEach(i => { i.el.style.transform = `translate(${i.x}px, ${i.y}px)`; i.el.style.visibility = 'visible'; });

        let isPlaying = false;
        let gravityX = 0, gravityY = 0;
        const body = document.getElementById('game-body');
        const particlesContainer = document.getElementById('particles-container');

        // ç¢è£‚ç‰¹æ•ˆ
        function createExplosion(x, y) {
            // å¼ºåŠ›éœ‡åŠ¨ 400ms (å¦‚æœè®¾å¤‡æ”¯æŒ)
            if (navigator.vibrate) navigator.vibrate([50, 50, 200]);

            // è§¦å‘å‰§çƒˆå±å¹•æŠ–åŠ¨
            body.classList.remove('shake-screen');
            void body.offsetWidth; // å¼ºåˆ¶é‡ç»˜
            body.classList.add('shake-screen');

            // äº§ç”Ÿæ›´å¤šç²’å­ (20ä¸ª)
            for (let i = 0; i < 20; i++) {
                const p = document.createElement('div');
                p.classList.add('particle');
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                p.style.width = (Math.random() * 15 + 5) + 'px';
                p.style.height = p.style.width;
                p.style.background = Math.random() > 0.6 ? '#cd5c5c' : '#8b0000';
                particlesContainer.appendChild(p);

                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 15 + 5; // ç²’å­é£å¾—æ›´å¿«
                const velX = Math.cos(angle) * velocity;
                const velY = Math.sin(angle) * velocity;

                let opacity = 1;
                let posX = x, posY = y;

                const anim = setInterval(() => {
                    posX += velX; posY += velY;
                    // åŠ ä¸Šé‡åŠ›å½±å“ç²’å­
                    posY += 1; 
                    opacity -= 0.04;
                    p.style.left = posX + 'px';
                    p.style.top = posY + 'px';
                    p.style.opacity = opacity;
                    if (opacity <= 0) { clearInterval(anim); p.remove(); }
                }, 20);
            }
        }

        function animate() {
            if(isPlaying) {
                const cw = window.innerWidth, ch = window.innerHeight;
                items.forEach(i => {
                    // æ›´æ–°å†·å´æ—¶é—´
                    if (i.cooldown > 0) i.cooldown--;

                    // ç‰©ç†è¿åŠ¨
                    i.vx += gravityX * 0.6;
                    i.vy += gravityY * 0.6;
                    i.vx *= 0.98; i.vy *= 0.98;
                    i.x += i.vx; i.y += i.vy;

                    // è®¡ç®—å½“å‰åˆé€Ÿåº¦å¤§å°
                    const speed = Math.sqrt(i.vx*i.vx + i.vy*i.vy);

                    let hit = false;
                    let hitX = 0, hitY = 0;

                    if (i.x <= 0) {
                        i.x = 0; i.vx *= -0.6; 
                        hit = true; hitX = 0; hitY = i.y + i.h/2;
                    }
                    if (i.x + i.w >= cw) {
                        i.x = cw - i.w; i.vx *= -0.6;
                        hit = true; hitX = cw; hitY = i.y + i.h/2;
                    }
                    if (i.y <= 0) {
                        i.y = 0; i.vy *= -0.6;
                        hit = true; hitX = i.x + i.w/2; hitY = 0;
                    }
                    if (i.y + i.h >= ch) {
                        i.y = ch - i.h; i.vy *= -0.6;
                        hit = true; hitX = i.x + i.w/2; hitY = ch;
                    }

                    // --- æ ¸å¿ƒé˜²æŠ–é€»è¾‘ ---
                    // è§¦å‘æ¡ä»¶ï¼š
                    // 1. å‘ç”Ÿäº†ç¢°æ’ (hit == true)
                    // 2. é€Ÿåº¦è¶³å¤Ÿå¿« (speed > 8) -> åªæœ‰ç”¨åŠ›æ’æ‰è§¦å‘ï¼Œé˜²æ­¢æ»‘è¡Œè§¦å‘
                    // 3. å†·å´å®Œæ¯• (cooldown <= 0) -> é˜²æ­¢è¿ç»­è§¦å‘
                    if (hit && speed > 8 && i.cooldown <= 0) {
                        createExplosion(hitX, hitY);
                        i.cooldown = 20; // å†·å´ 20 å¸§ (çº¦0.3ç§’)
                    }
                    
                    i.el.style.transform = `translate(${i.x}px, ${i.y}px)`;
                });
            }
            requestAnimationFrame(animate);
        }
        animate();

        const bgm = document.getElementById('bgm');
        const overlay = document.getElementById('start-overlay');
        const status = document.getElementById('status');
        const playBtn = document.getElementById('play-btn');

        function handleOrientation(event) {
            gravityX = (event.gamma || 0) / 4; 
            gravityY = (event.beta || 0) / 4;
        }

        async function startGame() {
            if(isPlaying) return;
            status.textContent = "æ­£åœ¨è¯·æ±‚æƒé™...";
            
            bgm.volume = 1.0; bgm.currentTime = 0;
            bgm.play().then(() => { bgm.playbackRate = 1.5; }).catch(console.log);

            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permissionState = await DeviceOrientationEvent.requestPermission();
                    if (permissionState === 'granted') {
                        window.addEventListener('deviceorientation', handleOrientation);
                    } else {
                        alert("æ²¡æœ‰æƒé™ï¼Œæ— æ³•ä½“æ„Ÿæ§åˆ¶");
                    }
                } catch (e) { console.error(e); }
            } else {
                window.addEventListener('deviceorientation', handleOrientation);
            }

            overlay.style.display = 'none';
            document.body.classList.add('playing');
            isPlaying = true;
        }

        playBtn.addEventListener('click', startGame);
    </script>
</body>
</html>
